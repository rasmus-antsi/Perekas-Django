{% extends "base.html" %}

{% block title %}Ostunimekiri | Luminara{% endblock %}

{% block nav_shopping_active %} active{% endblock %}

{% block content %}
  <div class="page-container">
    <header class="page-header">
      <div>
        <h1 class="page-title">Ostunimekiri</h1>
        <p class="page-subtitle">
          {{ to_buy_count }} eset nimekirjas, {{ in_cart_count }} korvis
        </p>
      </div>
      <button class="pill-button" type="button">{{ family_name }}</button>
    </header>

    <form method="post" class="add-item-card">
      {% csrf_token %}
      <input type="hidden" name="action" value="add">
      <label class="visually-hidden" for="new-item-input">Lisa uus ese</label>
      <input
        id="new-item-input"
        name="name"
        type="text"
        placeholder="Lisa uus ese..."
        {% if not has_family %}disabled{% endif %}
        required
      >
      <button type="submit" class="primary-button" {% if not has_family %}disabled{% endif %}>
        <span aria-hidden="true">+</span>
        <span>Lisa</span>
      </button>
    </form>

    <section class="list-section">
      <header class="list-section-header">
        <span class="list-section-icon need-icon" aria-hidden="true"></span>
        <h2>Vaja osta</h2>
      </header>

      <div class="list-items">
        {% if to_buy_items %}
          {% for item in to_buy_items %}
            <article class="item-card">
              <div>
                <h3 class="item-name">{{ item.name }}</h3>
                <p class="item-meta">Lisas {{ item.added_by.get_full_name|default:item.added_by.username }}</p>
              </div>
              <div class="item-actions">
                <form method="post" class="icon-form">
                  {% csrf_token %}
                  <input type="hidden" name="action" value="toggle">
                  <input type="hidden" name="item_id" value="{{ item.id }}">
                  <input type="hidden" name="set_in_cart" value="true">
                  <button type="submit" class="icon-button success" aria-label="Märgi {{ item.name }} korvis olevaks">
                    <svg viewBox="0 0 24 24" aria-hidden="true">
                      <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                  </button>
                </form>
                <form method="post" class="icon-form">
                  {% csrf_token %}
                  <input type="hidden" name="action" value="delete">
                  <input type="hidden" name="item_id" value="{{ item.id }}">
                  <button type="submit" class="icon-button" aria-label="Eemalda {{ item.name }}">
                    <svg viewBox="0 0 24 24" aria-hidden="true">
                      <line x1="18" y1="6" x2="6" y2="18"></line>
                      <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                  </button>
                </form>
              </div>
            </article>
          {% endfor %}
        {% else %}
          <p class="empty-state">Nimekiri on tühi. Lisa esimene ese, et alustada.</p>
        {% endif %}
      </div>
    </section>

    <section class="list-section">
      <header class="list-section-header">
        <span class="list-section-icon cart-icon" aria-hidden="true"></span>
        <h2>Korvis</h2>
      </header>

      <div class="list-items">
        {% if in_cart_items %}
          {% for item in in_cart_items %}
            <article class="item-card in-cart">
              <div>
                <h3 class="item-name">{{ item.name }}</h3>
                <p class="item-meta">Lisas {{ item.added_by.get_full_name|default:item.added_by.username }}</p>
              </div>
              <div class="item-actions">
                <form method="post" class="icon-form">
                  {% csrf_token %}
                  <input type="hidden" name="action" value="toggle">
                  <input type="hidden" name="item_id" value="{{ item.id }}">
                  <input type="hidden" name="set_in_cart" value="false">
                  <button type="submit" class="icon-button success" aria-label="Liiguta {{ item.name }} tagasi nimekirja">
                    <svg viewBox="0 0 24 24" aria-hidden="true">
                      <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                  </button>
                </form>
                <form method="post" class="icon-form">
                  {% csrf_token %}
                  <input type="hidden" name="action" value="delete">
                  <input type="hidden" name="item_id" value="{{ item.id }}">
                  <button type="submit" class="icon-button" aria-label="Kustuta {{ item.name }}">
                    <svg viewBox="0 0 24 24" aria-hidden="true">
                      <line x1="18" y1="6" x2="6" y2="18"></line>
                      <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                  </button>
                </form>
              </div>
            </article>
          {% endfor %}
        {% else %}
          <p class="empty-state">Korvis pole veel midagi.</p>
        {% endif %}
      </div>
    </section>
  </div>
{% endblock %}

