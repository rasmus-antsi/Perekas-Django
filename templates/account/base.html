{% load static %}
<!DOCTYPE html>
<html lang="et">
  <head>
    {% if not DEBUG %}
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-EE45M236XG"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-EE45M236XG');
    </script>
    <!-- Meta Pixel Code -->
    <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '1565490157978455');
    fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=1565490157978455&ev=PageView&noscript=1"
    /></noscript>
    <!-- End Meta Pixel Code -->
    {% endif %}
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Perekas{% endblock %}</title>
    <!-- Favicon with proper sizes for better transparency support -->
    <link rel="icon" type="image/png" sizes="192x192" href="{% static 'logos/perekas-logo.png' %}">
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'logos/perekas-logo.png' %}">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'logos/perekas-logo.png' %}">
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'logos/perekas-logo.png' %}">
    <link rel="mask-icon" href="{% static 'logos/perekas-logo.png' %}" color="#8b5cf6">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    >
    <link rel="stylesheet" href="{% static 'styles.css' %}">
    <style>
      /* Share dashboard-style toast messages */
      .messages-container {
        position: fixed !important;
        top: 1.5rem !important;
        left: 50% !important;
        transform: translateX(-50%) !important;
        z-index: 10000 !important;
        display: flex !important;
        flex-direction: column !important;
        gap: 0.75rem !important;
        max-width: 600px !important;
        width: calc(100% - 3rem) !important;
        pointer-events: none !important;
      }
      .message-toast {
        position: relative !important;
        display: flex !important;
        align-items: center !important;
        justify-content: space-between !important;
        gap: 1rem !important;
        padding: 1rem 1.25rem !important;
        border-radius: 1rem !important;
        backdrop-filter: blur(12px) !important;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4) !important;
        border: 1px solid !important;
        pointer-events: auto !important;
        min-width: 300px !important;
        background: rgba(15, 23, 42, 0.9) !important;
      }
      .message-toast-success {
        background: rgba(34, 197, 94, 0.15) !important;
        border-color: rgba(34, 197, 94, 0.4) !important;
        color: #22c55e !important;
      }
      .message-toast-error {
        background: rgba(239, 68, 68, 0.15) !important;
        border-color: rgba(239, 68, 68, 0.4) !important;
        color: #ef4444 !important;
      }
      .message-toast-warning {
        background: rgba(245, 158, 11, 0.15) !important;
        border-color: rgba(245, 158, 11, 0.4) !important;
        color: #f59e0b !important;
      }
      .message-toast-info {
        background: rgba(59, 130, 246, 0.15) !important;
        border-color: rgba(59, 130, 246, 0.4) !important;
        color: #3b82f6 !important;
      }
      .message-toast-content {
        flex: 1;
      }
      .message-toast-text {
        font-weight: 500;
        font-size: 0.95rem;
      }
      .message-toast-dismiss {
        background: transparent;
        border: none;
        color: inherit;
        cursor: pointer;
        padding: 0.15rem;
        display: grid;
        place-items: center;
      }
      .message-toast-dismiss svg {
        width: 16px;
        height: 16px;
      }
    </style>
  </head>
  <body class="landing-body">
    <div class="landing-background"></div>

    <header class="landing-nav">
      <a href="{% url 'a_landing:landing_index' %}" class="landing-brand">
        <img src="{% static 'logos/perekas-logo.png' %}" alt="Perekas" class="landing-logo" />
        <div>
          <span class="landing-brand-title">Perekas</span>
          <span class="landing-brand-tagline">Koos iga päev</span>
        </div>
      </a>
      <nav class="landing-nav-links">
        <a href="{% url 'a_landing:landing_index' %}">Kodu</a>
        <a href="{% url 'a_landing:features' %}">Võimalused</a>
        <a href="{% url 'a_landing:about' %}">Meist</a>
        <a href="{% url 'a_landing:plans' %}">Paketid</a>
      </nav>
      <div class="landing-nav-actions">
        {% if user.is_authenticated %}
          <a class="landing-link" href="{% url 'a_dashboard:dashboard' %}">Ülevaade</a>
        {% else %}
          <a class="landing-link" href="{% url 'account_login' %}">Logi sisse</a>
          <a class="landing-button primary" href="{% url 'account_signup' %}">Loo konto</a>
        {% endif %}
      </div>
      <button class="landing-nav-toggle" aria-label="Lülita menüü">
        <span aria-hidden="true"></span>
      </button>
    </header>

    {% if messages %}
      <div class="messages-container" id="messagesContainer">
        {% for message in messages %}
          {% with tag=message.tags|default:'info' %}
            <div class="message-toast message-toast-{{ tag }}" role="alert" data-message-tag="{{ tag }}">
              <div class="message-toast-content">
                <span class="message-toast-text">{{ message }}</span>
              </div>
              <button type="button" class="message-toast-dismiss" aria-label="Sulge" onclick="dismissMessage(this)">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
              </button>
            </div>
          {% endwith %}
        {% endfor %}
      </div>
    {% endif %}

    <main class="auth-main">
      <div class="auth-container">
        {% block content %}{% endblock %}
      </div>
    </main>

    <script>
      const toggle = document.querySelector('.landing-nav-toggle');
      const navLinks = document.querySelector('.landing-nav-links');
      const navActions = document.querySelector('.landing-nav-actions');
      if (toggle) {
        toggle.addEventListener('click', () => {
          toggle.classList.toggle('open');
          navLinks.classList.toggle('open');
          navActions.classList.toggle('open');
        });
      }

      function dismissMessage(button) {
        const message = button.closest('.message-toast');
        message.style.opacity = '0';
        message.style.transform = 'translateY(-10px)';
        setTimeout(() => {
          message.remove();
          const container = document.getElementById('messagesContainer');
          if (container && container.children.length === 0) {
            container.remove();
          }
        }, 200);
      }

      document.addEventListener('DOMContentLoaded', function() {
        const messages = document.querySelectorAll('.message-toast');
        messages.forEach((message, index) => {
          setTimeout(() => {
            const dismissBtn = message.querySelector('.message-toast-dismiss');
            if (dismissBtn) {
              dismissBtn.click();
            }
          }, 5000 + (index * 200));
        });
      });
    </script>
  </body>
</html>

